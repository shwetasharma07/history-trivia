<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Multiplayer - BrainRace</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="lobby-page">
    <div class="lobby-container">
        <div class="lobby-card bounce-in">
            <div class="lobby-header">
                <a href="/" class="back-link">&#x2190; Back</a>
                <h1 class="lobby-title">
                    <span>&#x26A1;</span>
                    Real-Time Battle
                </h1>
                <p class="lobby-subtitle">Compete live against friends!</p>
            </div>

            <!-- Tab Selector -->
            <div class="lobby-tabs">
                <button class="tab-btn active" data-tab="create">Create Game</button>
                <button class="tab-btn" data-tab="join">Join Game</button>
            </div>

            <!-- Create Game Tab -->
            <div class="tab-content active" id="create-tab">
                <form id="create-form" class="lobby-form">
                    <div class="form-group">
                        <label for="host-name">Your Name</label>
                        <input type="text" id="host-name" placeholder="Enter your name..." maxlength="15" required>
                    </div>

                    <div class="form-group">
                        <label>Categories</label>
                        <div class="category-chips">
                            <label class="chip">
                                <input type="checkbox" name="category" value="ancient-civilizations" checked>
                                <span>&#x1F3FA; Ancient</span>
                            </label>
                            <label class="chip">
                                <input type="checkbox" name="category" value="medieval-europe" checked>
                                <span>&#x2694;&#xFE0F; Medieval</span>
                            </label>
                            <label class="chip">
                                <input type="checkbox" name="category" value="world-wars" checked>
                                <span>&#x1F3C6; World Wars</span>
                            </label>
                            <label class="chip">
                                <input type="checkbox" name="category" value="cold-war" checked>
                                <span>&#x2744;&#xFE0F; Cold War</span>
                            </label>
                            <label class="chip">
                                <input type="checkbox" name="category" value="science" checked>
                                <span>&#x1F52C; Science</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Difficulty</label>
                        <div class="difficulty-chips">
                            <label class="chip">
                                <input type="radio" name="difficulty" value="progressive" checked>
                                <span>&#x1F4C8; Progressive</span>
                            </label>
                            <label class="chip">
                                <input type="radio" name="difficulty" value="mixed">
                                <span>&#x1F500; Mixed</span>
                            </label>
                            <label class="chip">
                                <input type="radio" name="difficulty" value="hard">
                                <span>&#x1F534; Hard</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="create-btn realtime-btn">
                        <span>&#x26A1;</span> Create Live Game
                    </button>
                </form>
            </div>

            <!-- Join Game Tab -->
            <div class="tab-content" id="join-tab">
                <form id="join-form" class="lobby-form">
                    <div class="form-group">
                        <label for="player-name">Your Name</label>
                        <input type="text" id="player-name" placeholder="Enter your name..." maxlength="15" required>
                    </div>

                    <div class="form-group">
                        <label for="room-code">Room Code</label>
                        <input type="text" id="room-code" placeholder="Enter 5-letter code..." maxlength="5" class="code-input" required>
                    </div>

                    <button type="submit" class="join-btn realtime-btn">
                        <span>&#x26A1;</span> Join Live Game
                    </button>
                </form>
            </div>

            <div class="realtime-info">
                <div class="info-badge">
                    <span>&#x23F1;&#xFE0F;</span>
                    <span>15 seconds per question</span>
                </div>
                <div class="info-badge">
                    <span>&#x1F4CA;</span>
                    <span>Live score updates</span>
                </div>
            </div>

            <div class="lobby-footer">
                <a href="/" class="home-link">&#x1F3E0; Back to Home</a>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const createForm = document.getElementById('create-form');
            const joinForm = document.getElementById('join-form');
            const roomCodeInput = document.getElementById('room-code');

            // Load saved username
            const savedUsername = sessionStorage.getItem('username');
            if (savedUsername) {
                document.getElementById('host-name').value = savedUsername;
                document.getElementById('player-name').value = savedUsername;
            }

            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                });
            });

            // Room code formatting
            roomCodeInput.addEventListener('input', (e) => {
                e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            });

            // Create game
            createForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const hostName = document.getElementById('host-name').value.trim();
                const categories = Array.from(document.querySelectorAll('#create-tab input[name="category"]:checked'))
                    .map(cb => cb.value).join(',');
                const difficulty = document.querySelector('#create-tab input[name="difficulty"]:checked').value;

                if (!hostName) {
                    alert('Please enter your name');
                    return;
                }

                if (!categories) {
                    alert('Please select at least one category');
                    return;
                }

                sessionStorage.setItem('username', hostName);
                sessionStorage.setItem('realtimeCategories', categories);
                sessionStorage.setItem('realtimeDifficulty', difficulty);
                sessionStorage.setItem('isHost', 'true');

                window.location.href = `/realtime/create`;
            });

            // Join game
            joinForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const playerName = document.getElementById('player-name').value.trim();
                const roomCode = roomCodeInput.value.trim();

                if (!playerName) {
                    alert('Please enter your name');
                    return;
                }

                if (roomCode.length !== 5) {
                    alert('Please enter a valid 5-character room code');
                    return;
                }

                sessionStorage.setItem('username', playerName);
                sessionStorage.setItem('isHost', 'false');

                window.location.href = `/realtime/${roomCode}`;
            });
        });
    </script>
</body>
</html>
